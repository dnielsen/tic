<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Build and deploy drat repository — do_drat • tic</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>



<!-- Bootstrap -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>

<!-- ropensci -->
<link href="../ropensci.css?nocache=123" rel="stylesheet">

<meta property="og:title" content="Build and deploy drat repository — do_drat" />
<meta property="og:description" content="do_drat() builds and deploys R packages to a drat repository and adds
default steps to the &quot;install&quot;, &quot;before_deploy&quot; and &quot;deploy&quot; stages:

step_setup_ssh() in the &quot;before_deploy&quot; to setup
the upcoming deployment
step_setup_push_deploy() in the &quot;before_deploy&quot; stage
(if deploy is set),
step_add_to_drat() in the &quot;deploy&quot;
step_do_push_deploy() in the &quot;deploy&quot; stage.

" />
<meta name="twitter:card" content="summary" />


<meta name="robots" content="noindex">



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-462421-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-462421-8');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci" /></a>
        <a class="navbar-brand" href="../index.html"><i>tic <small>v0.8.0.9008</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Introduction
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/features.html">Feature Overview</a>
    </li>
    <li>
      <a href="../articles/build-lifecycle.html">The CI Build Lifecycle</a>
    </li>
    <li>
      <a href="../articles/ci-client-packages.html">CI Client Packages</a>
    </li>
    <li>
      <a href="../articles/ci-providers.html">CI Providers</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/advanced.html">Advanced Usage</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deployment</a>
    </li>
    <li>
      <a href="../articles/custom-steps.html">Custom Steps</a>
    </li>
    <li>
      <a href="../articles/updating.html">Updating Templates</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ropensci/tic/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Build and deploy drat repository</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/tic/blob/master/R/macro-drat.R'><code>R/macro-drat.R</code></a></small>
    <div class="hidden name"><code>do_drat.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>do_drat()</code> builds and deploys R packages to a drat repository and adds
default steps to the <code>"install"</code>, <code>"before_deploy"</code> and <code>"deploy"</code> stages:</p>
<ol>
<li><p><code><a href='step_setup_ssh.html'>step_setup_ssh()</a></code> in the <code>"before_deploy"</code> to setup
the upcoming deployment</p></li>
<li><p><code><a href='step_setup_push_deploy.html'>step_setup_push_deploy()</a></code> in the <code>"before_deploy"</code> stage
(if <code>deploy</code> is set),</p></li>
<li><p><code><a href='step_add_to_drat.html'>step_add_to_drat()</a></code> in the <code>"deploy"</code></p></li>
<li><p><code><a href='step_do_push_deploy.html'>step_do_push_deploy()</a></code> in the <code>"deploy"</code> stage.</p></li>
</ol>

    </div>

    <pre class="usage"><span class='fu'>do_drat</span>(
  <span class='kw'>repo_slug</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>orphan</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>checkout</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>path</span> <span class='kw'>=</span> <span class='st'>"~/git/drat"</span>,
  <span class='kw'>branch</span> <span class='kw'>=</span> <span class='st'>"master"</span>,
  <span class='kw'>remote_url</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>commit_message</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>commit_paths</span> <span class='kw'>=</span> <span class='st'>"."</span>,
  <span class='kw'>force</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>private_key_name</span> <span class='kw'>=</span> <span class='st'>"TIC_DEPLOY_KEY"</span>,
  <span class='kw'>deploy_dev</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>repo_slug</th>
      <td><p><code>[string]</code><br />
The name of the drat repository to deploy to in the form <code>:owner/:repo</code>.</p></td>
    </tr>
    <tr>
      <th>orphan</th>
      <td><p><code>[flag]</code><br />
Create and force-push an orphan branch consisting of only one commit?
This can be useful e.g. for <code>path = "docs", branch = "gh-pages"</code>,
but cannot be applied for pushing to the current branch.</p></td>
    </tr>
    <tr>
      <th>checkout</th>
      <td><p><code>[flag]</code><br />
Check out the current contents of the repository? Defaults to <code>TRUE</code>,
set to <code>FALSE</code> if the build process relies on existing contents or
if you deploy to a different branch.</p></td>
    </tr>
    <tr>
      <th>path, branch</th>
      <td><p>By default, this macro deploys the <code>"master"</code> branch
of the drat repository. An alternative option is <code>"gh-pages"</code>.</p></td>
    </tr>
    <tr>
      <th>remote_url</th>
      <td><p><code>[string]</code><br />
The URL of the remote Git repository to push to, defaults to the
current GitHub repository.</p></td>
    </tr>
    <tr>
      <th>commit_message</th>
      <td><p><code>[string]</code><br />
Commit message to use, defaults to a useful message linking to the CI build
and avoiding recursive CI runs.</p></td>
    </tr>
    <tr>
      <th>commit_paths</th>
      <td><p><code>[character]</code><br />
Restrict the set of directories and/or files added to Git before deploying.
Default: deploy all files.</p></td>
    </tr>
    <tr>
      <th>force</th>
      <td><p><code>[logical]</code><br />
Add <code>--force</code> flag to git commands?</p></td>
    </tr>
    <tr>
      <th>private_key_name</th>
      <td><p><code>string</code><br />
Only needed when deploying from builds on Travis CI or GitHub Actions.
If you have set a custom name for the private key during creation of the
SSH key pair via <code><a href='https://rdrr.io/pkg/travis/man/use_travis_deploy.html'>travis::use_travis_deploy()</a></code>,
<code><a href='use_ghactions_deploy.html'>tic::use_ghactions_deploy()</a></code> or <code><a href='use_tic.html'>use_tic()</a></code>, pass this name here.</p></td>
    </tr>
    <tr>
      <th>deploy_dev</th>
      <td><p><code>[logical]</code><br />
Should development versions of packages also be deployed to the drat repo?
By default only "major", "minor" and "patch" releases are build and
deployed.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="deployment"><a class="anchor" href="#deployment"></a>Deployment</h2>

    <p>Deployment can only happen to the <code>master</code> or
<code>gh-pages</code> branch because the GitHub Pages functionality from GitHub is
used to access the drat repository later on. You need to enable this
functionality when creating the drat repository on GitHub via <code>Settings -&gt; GitHub pages</code> and set it to the chosen setting here.</p>
<p>To build and deploy Windows binaries, builds on Travis CI with deployment
permissions need to be triggered. To build and deploy macOS binaries,
builds on Travis CI with deployment permissions need to be triggered. Have
a look at <a href='https://docs.ropensci.org/tic/articles/deployment.html'>https://docs.ropensci.org/tic/articles/deployment.html</a> for
more information and instructions.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other macros: 
<code><a href='do_blogdown.html'>do_blogdown</a>()</code>,
<code><a href='do_bookdown.html'>do_bookdown</a>()</code>,
<code><a href='do_package_checks.html'>do_package_checks</a>()</code>,
<code><a href='do_pkgdown.html'>do_pkgdown</a>()</code>,
<code><a href='do_readme_rmd.html'>do_readme_rmd</a>()</code>,
<code><a href='list_macros.html'>list_macros</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='dsl_get.html'>dsl_init</a></span>()</div><div class='output co'>#&gt; <span class='message'><span style='color: #00BB00;'>✔</span><span> Creating a clean tic stage configuration</span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #00BBBB;'>ℹ</span><span> See </span><span style='color: #000000;background-color: #BBBBBB;'>`?tic::dsl_get`</span><span> for details</span></div><div class='input'>
<span class='fu'>do_drat</span>()</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #00BBBB;'>──</span><span> </span><span style='font-weight: bold;'>tic configuration</span><span> </span><span style='color: #00BBBB;'>───────────────────────────────────────────────────────────</span><span></span></div><div class='output co'>#&gt; </span><span style='color: #00BB00;'>──</span><span> </span><span style='color: #00BB00;'>before_deploy</span><span> </span><span style='color: #00BB00;'>──────────────────────────────────────────────────────</span><span> </span><span style='color: #00BB00;'>stage</span><span> </span><span style='color: #00BB00;'>──</span><span>
#&gt; ▶ step_setup_ssh(private_key_name = private_key_name)
#&gt; ▶ step_setup_push_deploy(path = "~/git/drat", branch = "master", 
#&gt;     remote_url = paste0("git@github.com:", repo_slug, ".git"), 
#&gt;     orphan = FALSE, checkout = TRUE)
#&gt; </span><span style='color: #00BB00;'>──</span><span> </span><span style='color: #00BB00;'>deploy</span><span> </span><span style='color: #00BB00;'>─────────────────────────────────────────────────────────────</span><span> </span><span style='color: #00BB00;'>stage</span><span> </span><span style='color: #00BB00;'>──</span><span>
#&gt; ▶ step_add_to_drat(repo_slug = repo_slug, deploy_dev = deploy_dev)
#&gt; ▶ step_do_push_deploy(path = "~/git/drat", commit_message = NULL, 
#&gt;     commit_paths = ".", force = FALSE)</div><div class='input'>
<span class='fu'><a href='dsl_get.html'>dsl_get</a></span>()</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #00BBBB;'>──</span><span> </span><span style='font-weight: bold;'>tic configuration</span><span> </span><span style='color: #00BBBB;'>───────────────────────────────────────────────────────────</span><span></span></div><div class='output co'>#&gt; </span><span style='color: #00BB00;'>──</span><span> </span><span style='color: #00BB00;'>before_deploy</span><span> </span><span style='color: #00BB00;'>──────────────────────────────────────────────────────</span><span> </span><span style='color: #00BB00;'>stage</span><span> </span><span style='color: #00BB00;'>──</span><span>
#&gt; ▶ step_setup_ssh(private_key_name = private_key_name)
#&gt; ▶ step_setup_push_deploy(path = "~/git/drat", branch = "master", 
#&gt;     remote_url = paste0("git@github.com:", repo_slug, ".git"), 
#&gt;     orphan = FALSE, checkout = TRUE)
#&gt; </span><span style='color: #00BB00;'>──</span><span> </span><span style='color: #00BB00;'>deploy</span><span> </span><span style='color: #00BB00;'>─────────────────────────────────────────────────────────────</span><span> </span><span style='color: #00BB00;'>stage</span><span> </span><span style='color: #00BB00;'>──</span><span>
#&gt; ▶ step_add_to_drat(repo_slug = repo_slug, deploy_dev = deploy_dev)
#&gt; ▶ step_do_push_deploy(path = "~/git/drat", commit_message = NULL, 
#&gt;     commit_paths = ".", force = FALSE)</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <!-- begin footer -->
<div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg" /></div>
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/ropensci" target="_blank"><div class="icon fab fa-github"></div></a>
                        <a href="http://github.com/ropenscilabs" target="_blank"><div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/ropensci" target="_blank"><div class="icon fab fa-twitter"></div></a>
                        <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
                            <h5 class="bottom-2">Info</h5>
                            <li><a href="https://ropensci.org/about">Mission</a></li>
                            <li><a href="https://ropensci.org/about#team">Team</a></li>
                            <li><a href="https://ropensci.org/about#collaborators">Collaborators</a></li>
                            <li><a href="https://ropensci.org/careers">Careers</a></li>
                        </ul>
                    </div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
                            <h5 class="bottom-2">Work</h5>
                            <li><a href="https://ropensci.org/packages/">Packages</a></li>
                            <li><a href="https://ropensci.org/blog/">Blog</a></li>
                            <li><a href="https://ropensci.org/technotes/">Tech Notes</a></li>
                            <li><a href="https://ropensci.org/tutorials/">Tutorials</a></li>
                            <li><a href="https://ropensci.org/usecases/">Use Cases</a></li>
                            <li><a href="https://ropensci.org/resources/">More Resources</a></li>
                        </ul>
                    </div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
                            <h5 class="bottom-2">Participate</h5>
                            <li><a href="https://ropensci.org/contact/">Contact us</a></li>
                            <li><a href="https://ropensci.org/community/">Community</a></li>
                            <li><a href="https://ropensci.org/software-review/">Contribute software</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct">Code of conduct</a></li>
                            <li><a href="https://ropensci.org/events/">Events</a></li>
                            <li><a href="https://ropensci.org/commcalls/">Community calls</a></li>
                            <li><a href="https://ropensci.org/donate/">Donate</a></li>
                        </ul>
                    </div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                        <a href="http://numfocus.org" target="_blank"></a>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
   </div>

  


  </body>
</html>



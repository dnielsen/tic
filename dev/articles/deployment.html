<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deployment • tic</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- ropensci --><link href="../ropensci.css?nocache=123" rel="stylesheet">
<meta property="og:title" content="Deployment">
<meta property="og:description" content="tic">
<meta name="twitter:card" content="summary">
<meta name="robots" content="noindex">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-462421-8"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-462421-8');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a href="https://ropensci.org"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
        <a class="navbar-brand" href="../index.html"><i>tic <small>v0.9.0.9004</small></i></a>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tic.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Introduction
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/features.html">Feature Overview</a>
    </li>
    <li>
      <a href="../articles/build-lifecycle.html">The CI Build Lifecycle</a>
    </li>
    <li>
      <a href="../articles/ci-client-packages.html">CI Client Packages</a>
    </li>
    <li>
      <a href="../articles/ci-providers.html">CI Providers</a>
    </li>
    <li>
      <a href="../articles/faq.html">FAQ</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/advanced.html">Advanced Usage</a>
    </li>
    <li>
      <a href="../articles/deployment.html">Deployment</a>
    </li>
    <li>
      <a href="../articles/custom-steps.html">Custom Steps</a>
    </li>
    <li>
      <a href="../articles/updating.html">Updating Templates</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ropensci/tic/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="deployment_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Deployment</h1>
                        <h4 class="author">Patrick Schratz, Kirill Müller</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/tic/blob/master/vignettes/deployment.Rmd"><code>vignettes/deployment.Rmd</code></a></small>
      <div class="hidden name"><code>deployment.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>{tic} uses the <a href="ci-client-packages.html">CI client packages</a> {travis} and {circle} for setting up deployment on the CI systems.</p>
<div id="travis-ci" class="section level3">
<h3 class="hasAnchor">
<a href="#travis-ci" class="anchor"></a>Travis CI</h3>
<ol style="list-style-type: decimal">
<li>
<p>When calling <code><a href="https://rdrr.io/pkg/travis/man/use_travis_deploy.html">travis::use_travis_deploy()</a></code> (either directly or indirectly by using <code><a href="../reference/use_tic.html">use_tic()</a></code>), a public key is added to GitHub repository under the “Deploy keys” section and the user receives an e-mail:</p>
<p><img src="img/ssh-deploy-key.png" style="display: block; margin: auto;"></p>
</li>
<li>
<p>A private key is encoded in base64 and stored in an environment variable on Travis. During the CI run, {tic} installs it in the <code>~/.ssh</code> directory so that it can be used for authentication:</p>
<p><img src="img/private-key-travis.png" style="display: block; margin: auto;"></p>
<p>Initiating the deployment via a public-private key pair has the advantage that rights are granted to a single repo only and the setup process can be automated.</p>
</li>
</ol>
</div>
<div id="circle-ci" class="section level3">
<h3 class="hasAnchor">
<a href="#circle-ci" class="anchor"></a>Circle CI</h3>
<p>On Circle CI, setting up deployment is easier than on Travis as there is no need to create a SSH key pair for deployment.</p>
<p>When calling <code><a href="https://rdrr.io/pkg/circle/man/use_circle_deploy.html">circle::use_circle_deploy()</a></code> directly (or indirectly via <code><a href="../reference/use_tic.html">tic::use_tic()</a></code>), a so called “user-key” is created and stored in the Circle CI repo. This key makes it possible to deploy from Circle CI builds to your GitHub repo. No extra deploy key need to be stored in the GitHub repo.</p>
</div>
<div id="appveyor-ci" class="section level3">
<h3 class="hasAnchor">
<a href="#appveyor-ci" class="anchor"></a>Appveyor CI</h3>
<p>Appveyor follows the same philosophy as Travis CI when it comes to deployment. A bunch of <a href="https://www.appveyor.com/docs/deployment/">predefined deployment providers</a> are available but deploying to the GitHub repo of the project is not possible. Unfortunately, there is no R client package for Appveyor yet. This means one needs to manually set up an SSH key pair which is used for deployment.</p>
<p>Usually we suggest to simply deploy on one of the other CI providers. However, when it comes to deployment to a drat repository (see <code>?do_drat()</code>), one usually also wants to build and deploy Windows binaries.</p>
<p>Follow these steps to add deployment capabilities via {tic} to Appveyor builds:</p>
<ol style="list-style-type: decimal">
<li>
<p>Generate a SSH key pair</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">key</span> <span class="kw">&lt;-</span> <span class="kw pkg">openssl</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/openssl/man/keygen.html">rsa_keygen</a></span>()

<span class="no">pub_key</span> <span class="kw">&lt;-</span> <span class="kw pkg">travis</span><span class="kw ns">:::</span><span class="fu"><a href="https://rdrr.io/pkg/travis/man/ssh_key_helpers.html">get_public_key</a></span>(<span class="no">key</span>)$<span class="no">ssh</span>
<span class="no">private_key</span> <span class="kw">&lt;-</span> <span class="kw pkg">travis</span><span class="kw ns">:::</span><span class="fu"><a href="https://rdrr.io/pkg/travis/man/ssh_key_helpers.html">encode_private_key</a></span>(<span class="no">key</span>)</pre></body></html></div>
</li>
<li><p>Copy the public key and add it as an deploy key to <code>Settings -&gt; Deploy Key</code> of the <em>drat repo you want to deploy to</em> (<strong>not</strong> the one of the package which should be deployed).</p></li>
<li><p>Copy the private key and log into to your Appveyor account. Go to <code>Account -&gt; Encrypt YAML</code> and encrypt the private key.</p></li>
<li><p>Copy the resulting snipped into the <code>appveyor.yml</code> file of the repo. Name the environment variable “id_rsa”.</p></li>
</ol>
<p>Now the Appveyor builds should be able to deploy to the drat repo (where you added the public key). If you are building a drat repo, make sure to also add <code>USE_RTOOLS: true</code> to <code>appveyor.yml</code>. Otherwise R cannot build binaries on Windows.</p>
<p>On a side note, we have an implicit R version requirement of &gt;= 3.4 when building on Appveyor. This is due to the fact that we are only allowing binary installs on Appveyor with {tic} due to some nasty issues when building packages from source on Appveyor in the past. The requirement is caused by the {cli} &gt;= 2.0.0 requirement of {tic}. This package version is not available as a binary on R =&lt; 3.5.</p>
</div>
<div id="github-actions" class="section level3">
<h3 class="hasAnchor">
<a href="#github-actions" class="anchor"></a>GitHub Actions</h3>
<p>GitHub Actions offers multiple options related to deployment:</p>
<ul>
<li>Deployment related actions on the GitHub marketplace</li>
<li>Supplying an <code>DEPLOY_PAT</code> secret as <a href="https://github.com/r-lib/actions/tree/master/examples#build-pkgdown-site">r-lib/actions</a> suggests</li>
<li>Using an SSH key pair with the private key stored as a “secret” in the repo and the public key as a “Deploy key” ({tic} default)</li>
</ul>
<p>To reflect a successful deployment in the repo checks, <a href="https://github.com/chrnorm/deployment-status">actions from the GitHub marketplace</a> help. For the actual deployment we recommend to use a SSH key pair. A SSH key can be easily created, is safe to use and when browsing at the “Deploy key” section of a repo, one can directly see if deployment was granted to a CI service for the repository.</p>
<p>To simplify the creation of a SSH key pair for deployment and adding the keys to the appropriate places, {tic} comes with a little helper function <code><a href="../reference/use_ghactions_deploy.html">use_ghactions_deploy()</a></code>. To use this function, you need a <code>GITHUB_PAT</code> with public repo scope defined in your <code>.Renviron</code>. <code><a href="https://usethis.r-lib.org/reference/browse_github_token.html">usethis::browse_github_pat()</a></code> helps setting one up if you haven’t done so already.</p>
<div id="updating-the-deployment-status" class="section level4">
<h4 class="hasAnchor">
<a href="#updating-the-deployment-status" class="anchor"></a>Updating the deployment status</h4>
<p>To update the deployment status in the “environments” menu (next to “release” and “branches”) conditionally on the outcome of the “Deployment” stage, one can use the <code>chrnorm/deployment-status</code>.</p>
<p>Add the following before the “Before Deploy” stage:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> chrnorm/deployment-action@v1.1.1</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="at">        </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Create GitHub deployment</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> deployment</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="at">          </span><span class="fu">token</span><span class="kw">:</span><span class="at"> </span><span class="st">"${{ github.token }}"</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="at">          </span><span class="fu">environment</span><span class="kw">:</span><span class="at"> production</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="at">```yml</span></span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="fu">and then this part after the "After Deploy" stage</span><span class="kw">:</span></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="at">```yml</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Update deployment status (success)</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> success()</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> chrnorm/deployment-status@releases/v1</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="at">          </span><span class="fu">token</span><span class="kw">:</span><span class="at"> </span><span class="st">"${{ github.token }}"</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="at">          </span><span class="fu">target-url</span><span class="kw">:</span><span class="at"> http://my-app-url.com</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="at">          </span><span class="fu">state</span><span class="kw">:</span><span class="at"> </span><span class="st">"success"</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="at">          </span><span class="fu">deployment_id</span><span class="kw">:</span><span class="at"> ${{ steps.deployment.outputs.deployment_id }}</span></span>
<span id="cb2-20"><a href="#cb2-20"></a></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Update deployment status (failure)</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> failure()</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> chrnorm/deployment-status@releases/v1</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="at">          </span><span class="fu">token</span><span class="kw">:</span><span class="at"> </span><span class="st">"${{ github.token }}"</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="at">          </span><span class="fu">target-url</span><span class="kw">:</span><span class="at"> http://my-app-url.com</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="at">          </span><span class="fu">state</span><span class="kw">:</span><span class="at"> </span><span class="st">"failure"</span></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="at">          </span><span class="fu">deployment_id</span><span class="kw">:</span><span class="at"> ${{ steps.deployment.outputs.deployment_id }}</span></span></code></pre></div>
</div>
</div>
</div>
<div id="pkgdown-deployment" class="section level2">
<h2 class="hasAnchor">
<a href="#pkgdown-deployment" class="anchor"></a>{pkgdown} deployment</h2>
<p><a href="https://github.com/r-lib/pkgdown">{pkgdown}</a> is an R package which builds a documentation wrapper-site of an R package. It collects all the vignettes, function references and metadata information of a package and presents it in an eye-appealing HTML version.</p>
<p>It has become a quasi-standard to provide a {pkgdown} site for an R package. However, it is tedious to update the {pkgdown} site manually on every commit, check whether something has changed and commit the changes. {tic} comes with the ability to automate this process.</p>
<p>The following example shows how {tic} deploys a {pkgdown} site on Travis CI. Remember that you can freely choose your favorite provider for this task. In <code>.travis.yml</code> file the “before_deploy” and “deploy” stages are redirected to {tic}.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">before_deploy</span><span class="kw">:</span><span class="at"> R -q -e 'tic::before_deploy()'</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="at">  </span><span class="fu">provider</span><span class="kw">:</span><span class="at"> script</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="at">  </span><span class="fu">script</span><span class="kw">:</span><span class="at"> R -q -e 'tic::deploy()'</span></span></code></pre></div>
<p>In the “before_deploy” stage, {tic} will do the following:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="kw">if</span> (<span class="fu"><a href="../reference/ci.html">ci_on_travis</a></span>()) {
  <span class="fu"><a href="../reference/dsl.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())
}</pre></body></html></div>
<ul>
<li>
<p>Calls <code><a href="../reference/step_setup_ssh.html">step_setup_ssh()</a></code> if the environment variable <code>"BUILD_PKGDOWN"</code> is set in the Travis CI build. This step sets up SSH key previously added to the GitHub and Travis via <code><a href="https://rdrr.io/pkg/travis/man/use_travis_deploy.html">travis::use_travis_deploy()</a></code>. Argument <code>private_key_name</code> can be ignored as long as no custom private key name was used during <code><a href="https://rdrr.io/pkg/travis/man/use_travis_deploy.html">travis::use_travis_deploy()</a></code>. If so, then supply it via the <code>private_key_name</code> argument in <code><a href="../reference/do_pkgdown.html">do_pkgdown()</a></code>.</p>
<p>For backward compatibility, the deprecated default <code>"id_rsa"</code> is supported out of the box.</p>
</li>
<li><p>Calls <code><a href="../reference/dsl.html">add_step(step_build_pkgdown())</a></code> and <code><a href="../reference/dsl.html">add_step(step_push_deploy())</a></code> in the “deploy” stage.</p></li>
</ul>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/dsl.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_build_pkgdown.html">step_build_pkgdown</a></span>()) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>())</pre></body></html></div>
<p><code><a href="../reference/step_build_pkgdown.html">step_build_pkgdown()</a></code> will build the {pkgdown} site and afterwards (note the <code>pipe</code> operator chaining the commands), <code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code> takes care pushing the results to the repo. By default the site will be pushed to the <code>gh-pages</code> branch of your repo, keeping the history.</p>
<div id="deploying-to-docs-master-or-gh-pages-branch" class="section level3">
<h3 class="hasAnchor">
<a href="#deploying-to-docs-master-or-gh-pages-branch" class="anchor"></a>Deploying to <code>docs/</code> (master) or <code>gh-pages</code> branch</h3>
<p>By default deployment is pushed to the <code>gh-pages</code> branch. This has the following advantages:</p>
<ul>
<li>No cluttering of the commit history in the master branch</li>
<li>Everything “just works” silently in the background</li>
</ul>
<div id="master-branch-deployment" class="section level4">
<h4 class="hasAnchor">
<a href="#master-branch-deployment" class="anchor"></a>master branch deployment</h4>
<p>Deploying to the <code>docs/</code> directory of the master branch has the following advantages:</p>
<ul>
<li>Per-branch versions of the {pkgdown} site (if desired)</li>
<li>Per-branch versions enable the possibility to have preview for pull requests via <a href="https://www.netlify.com/" class="uri">https://www.netlify.com/</a>
</li>
</ul>
<p>The disadvantage is that the master branch will be cluttered by automatic commits triggered by Travis CI that push the changes of the {pkgdown} site to the <code>master</code> branch.</p>
</div>
<div id="orphaning-the-gh-pages-branch" class="section level4">
<h4 class="hasAnchor">
<a href="#orphaning-the-gh-pages-branch" class="anchor"></a>Orphaning the <code>gh-pages</code> branch</h4>
<p>By default, changes to the {pkgdown} site will be added as incremental commits to the <code>gh-pages</code> branch. This is useful to keep a history of past versions and to enable a release and dev version of the site. To have this feature, set</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">development</span><span class="kw">:</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="at">  </span><span class="fu">mode</span><span class="kw">:</span><span class="at"> auto</span></span></code></pre></div>
<p>in your <code>_pkgdown.yml</code> file. See <code>?pkgdown::build_site()</code> for more information.</p>
<p>If you only want to have one version of your {pkgdown} site and not fill your repo with many commits in the <code>gh-pages</code> branch, you can use <code><a href="../reference/do_pkgdown.html">do_pkgdown(orphan = TRUE)</a></code>. This will wipe all commits of this branch on every CI run so that there is only one commit corresponding to the latest version of your pkgdown site.</p>
</div>
</div>
</div>
<div id="conditional-deployment" class="section level2">
<h2 class="hasAnchor">
<a href="#conditional-deployment" class="anchor"></a>Conditional deployment</h2>
<p>If you are running a <a href="https://docs.travis-ci.com/user/build-matrix/">build matrix</a> or <a href="https://docs.travis-ci.com/user/build-stages/">build stages</a> on Travis CI, you want to run certain tasks only once during a build. The creation of a {pkgdown} site is a common task which applies to this.</p>
<p>Another situation in which conditioning comes in handy is when you want to deploy multiple files in different stages. You can restrict on which stage/job a task is executed with the help of environment variables.</p>
<p>{tic} can make use of implicit set environment variables of the build and additional ones added by the user. In the following we show a “build stage” example on Travis CI using the custom env variable <code>"BUILD_PKGDOWN"</code>:</p>
<p><code>.travis.yml</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="at">  </span><span class="fu">include</span><span class="kw">:</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="at">    </span><span class="kw">-</span><span class="at"> </span><span class="fu">stage</span><span class="kw">:</span><span class="at"> stage1</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="at">      </span><span class="fu">env</span><span class="kw">:</span><span class="at"> BUILD_PKGDOWN=TRUE</span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="at">      </span><span class="fu">before_install</span><span class="kw">:</span><span class="at"> </span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="at">        </span><span class="kw">-</span><span class="at"> R -q -e 'install.packages("remotes")'</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="at">        </span><span class="kw">-</span><span class="at"> R -q -e 'remotes::install_github("ropensci/tic")'</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="at">        </span><span class="kw">-</span><span class="at"> R -q -e 'tic::prepare_all_stages(); tic::before_install()'</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="at">      </span><span class="kw">[</span><span class="at">...</span><span class="kw">]</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="at">      </span><span class="fu">deploy</span><span class="kw">:</span></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="at">        </span><span class="fu">provider</span><span class="kw">:</span><span class="at"> script</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="at">        </span><span class="fu">script</span><span class="kw">:</span><span class="at"> R -q -e 'tic::deploy()'</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="at">        </span><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="at">          </span><span class="fu">all_branches</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div>
<p><code>tic.R</code>:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="kw">if</span> (<span class="fu"><a href="../reference/ci.html">ci_has_env</a></span>(<span class="st">"TIC_DEPLOY_KEY"</span>)) {
  <span class="fu"><a href="../reference/dsl.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())
}

<span class="kw">if</span> (<span class="fu"><a href="https://rdrr.io/r/base/Logic.html">isTRUE</a></span>(<span class="st">"BUILD_PKGDOWN"</span>)) {
  <span class="fu"><a href="../reference/dsl.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_build_pkgdown.html">step_build_pkgdown</a></span>()) <span class="kw">%&gt;%</span>
    <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>())
}</pre></body></html></div>
</div>
<div id="committing-single-files" class="section level2">
<h2 class="hasAnchor">
<a href="#committing-single-files" class="anchor"></a>Committing single files</h2>
<p>The <code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code> step has the ability to restrict the files that are committed and pushed. This can be very useful for conditionally pushing documentation files like <code>NEWS</code> or <code>man/</code> and <code>NAMESPACE</code> if these are automatically created during the CI run.</p>
<p>In the following example, these files are created/updated by calling <code><a href="https://devtools.r-lib.org//reference/document.html">devtools::document()</a></code>. The <code>commit_paths</code> argument in <code><a href="../reference/step_push_deploy.html">step_push_deploy()</a></code> decides which files are committed and pushed:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/dsl.html">get_stage</a></span>(<span class="st">"before_deploy"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_setup_ssh.html">step_setup_ssh</a></span>())

<span class="fu"><a href="../reference/dsl.html">get_stage</a></span>(<span class="st">"deploy"</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dsl.html">add_code_step</a></span>(<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/document.html">document</a></span>(<span class="kw">roclets</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"rd"</span>, <span class="st">"collate"</span>, <span class="st">"namespace"</span>))) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="../reference/dsl.html">add_step</a></span>(<span class="fu"><a href="../reference/step_push_deploy.html">step_push_deploy</a></span>(<span class="kw">commit_paths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"NAMESPACE"</span>, <span class="st">"man/*"</span>)))</pre></body></html></div>
<p>Applying this idea depends on your overall R package development strategy: Commit files like <code>/man/</code> and <code>NAMESPACE</code> directly or let them be created during the CI run?</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="http://github.com/ropensci" target="_blank"><div class="icon fab fa-github"></div></a>
                        <a href="http://github.com/ropenscilabs" target="_blank"><div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/ropensci" target="_blank"><div class="icon fab fa-twitter"></div></a>
                        <a href="http://vimeo.com/ropensci" target="_blank"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Info</h5>
                            <li><a href="https://ropensci.org/about">Mission</a></li>
                            <li><a href="https://ropensci.org/about#team">Team</a></li>
                            <li><a href="https://ropensci.org/about#collaborators">Collaborators</a></li>
                            <li><a href="https://ropensci.org/careers">Careers</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Work</h5>
                            <li><a href="https://ropensci.org/packages/">Packages</a></li>
                            <li><a href="https://ropensci.org/blog/">Blog</a></li>
                            <li><a href="https://ropensci.org/technotes/">Tech Notes</a></li>
                            <li><a href="https://ropensci.org/tutorials/">Tutorials</a></li>
                            <li><a href="https://ropensci.org/usecases/">Use Cases</a></li>
                            <li><a href="https://ropensci.org/resources/">More Resources</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Participate</h5>
                            <li><a href="https://ropensci.org/contact/">Contact us</a></li>
                            <li><a href="https://ropensci.org/community/">Community</a></li>
                            <li><a href="https://ropensci.org/software-review/">Contribute software</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct">Code of conduct</a></li>
                            <li><a href="https://ropensci.org/events/">Events</a></li>
                            <li><a href="https://ropensci.org/commcalls/">Community calls</a></li>
                            <li><a href="https://ropensci.org/donate/">Donate</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" target="_blank">NumFOCUS</a></p>
                        <a href="http://numfocus.org" target="_blank"></a>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  


  </body>
</html>
